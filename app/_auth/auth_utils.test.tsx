/**
 * @jest-environment node
 */

import { describe, it, expect } from "@jest/globals";
import { isAccessCookieValid } from "../../app/_auth/auth_utils";

const id_token_expired='eyJraWQiOiJoK2VzNlNVNUVzQmhuTFJjdnpnckxFbk80UlRsQVQ2NWxuNFczQ2JpemhJPSIsImFsZyI6IlJTMjU2In0.eyJhdF9oYXNoIjoiM1Exb1BoTXpnWDNWOGNrM1JFZTVvUSIsInN1YiI6ImQ0NTgzNDE4LTMwYjEtNzA0Yi0yMzM4LTQ2YmYyODhkOTc3MiIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV9UWTdIczRxUGUiLCJwaG9uZV9udW1iZXJfdmVyaWZpZWQiOmZhbHNlLCJjb2duaXRvOnVzZXJuYW1lIjoiZDQ1ODM0MTgtMzBiMS03MDRiLTIzMzgtNDZiZjI4OGQ5NzcyIiwiYXVkIjoiMmRvcmR1OGpnbTg3NDUwaTRvcm51azRxaDMiLCJldmVudF9pZCI6IjAxNTRjMTE3LTEyNDktNGZlMi1hYWRlLWE5MjE5ZWE5NWFlYiIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNzAxOTA2NzE3LCJwaG9uZV9udW1iZXIiOiIrMTYxMzg2MjgyOTgiLCJleHAiOjE3MDE5MTAzMTcsImlhdCI6MTcwMTkwNjcxNywianRpIjoiYTI3NGVkNzAtODI4YS00NmE3LTgyMDQtZGFiZjIzNTBlMTZhIiwiZW1haWwiOiJzdGVwaGVuX3doZWVsZXJAeWFob28uY29tIn0.d3hr7gfvl8i0LBCCV5-Il9xNwXTtbkhaNpUjKPJX4s9DQqDN-egBj8N1lKjKcR9xgl8uQGVowWs3iEEzYfp5XfFpuYQa-lUyYoA1CKdB227dyfvzhsmDxOnx8INf4uaaCrMGrOdEGkccduHIK2lb8wkkHOJWNc_A_SZAf8wIPYVdHi_b4qYkijxVYuAjnpoxsh7YJBrEVX6j-SYDH8s8dCQGjgd6fV5sOzO_t3AyRUR8N4UPh2-rtshFS1FHND0LvLA5L8vznqEdWt6dWmLU2Q3AG7W5WlQ31eG-tSfKjepgm0Pl7GOgYsLgMFC7X0vBrdLMBSZ4p-UGK7-pMbHhBg';
const access_token_expired='eyJraWQiOiJWaW9GSjQ3SzVpZEg4dXF3cVFIMVhTZWNvVmluZDNEZzZCVGlUeWY0RWpBPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJkNDU4MzQxOC0zMGIxLTcwNGItMjMzOC00NmJmMjg4ZDk3NzIiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV9UWTdIczRxUGUiLCJ2ZXJzaW9uIjoyLCJjbGllbnRfaWQiOiIyZG9yZHU4amdtODc0NTBpNG9ybnVrNHFoMyIsImV2ZW50X2lkIjoiMDE1NGMxMTctMTI0OS00ZmUyLWFhZGUtYTkyMTllYTk1YWViIiwidG9rZW5fdXNlIjoiYWNjZXNzIiwic2NvcGUiOiJwaG9uZSBvcGVuaWQgZW1haWwiLCJhdXRoX3RpbWUiOjE3MDE5MDY3MTcsImV4cCI6MTcwMTkxMDMxNywiaWF0IjoxNzAxOTA2NzE3LCJqdGkiOiIzNzkwNGExMy02NTc2LTQyYTAtODNkNS03YmM5OWU1NjM4ODQiLCJ1c2VybmFtZSI6ImQ0NTgzNDE4LTMwYjEtNzA0Yi0yMzM4LTQ2YmYyODhkOTc3MiJ9.H7btwN5kHG1n-dbKuraeghnEmSAa-vXIaL6zlwsdLIFq18SFbeFE-TG2ciXv_lxDsDEddWBo4wgVKCO3KbTJTQYX6PVgDhTgrp4rPLfhaWc6HJX8IgwndpFhvjz2R6C6ImU6HpmwCIE93qQXJo3vLfQikypop8PBef2y8PMx8RGivXanGK_FEsAMHL1hkGy5S0aLfuFm37YZ7bY1QKvoGv3c9zcivyoN8xGCOTI4n8q3QjCQSq6uaOEkdqIEyzuxU5Vw6AtM939x807N7pAhupZmgqj0HKTjwkezw-qgqGMfhI8ZsxubOuscqDsyojkNFnmXnr167AgiekCUuiW1cQ';

// Invalid signature
const id_token_invalid='eyJraWQiOiJoK2VzNlNVNUVzQmhuTFJjdnpnckxFbk80UlRsQVQ2NWxuNFczQ2JpemhJPSIsImFsZyI6IlJTMjU2In0.eyJhdF9oYXNoIjoiM1Exb1BoTXpnWDmWOGNrM1JFZTVvUSIsInN1YiI6ImQ0NTgzNDE4LTMwYjEtNzA0Yi0yMzM4LTQ2YmYyODhkOTc3MiIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV9UWTdIczRxUGUiLCJwaG9uZV9udW1iZXJfdmVyaWZpZWQiOmZhbHNlLCJjb2duaXRvOnVzZXJuYW1lIjoiZDQ1ODM0MTgtMzBiMS03MDRiLTIzMzgtNDZiZjI4OGQ5NzcyIiwiYXVkIjoiMmRvcmR1OGpnbTg3NDUwaTRvcm51azRxaDMiLCJldmVudF9pZCI6IjAxNTRjMTE3LTEyNDktNGZlMi1hYWRlLWE5MjE5ZWE5NWFlYiIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNzAxOTA2NzE3LCJwaG9uZV9udW1iZXIiOiIrMTYxMzg2MjgyOTgiLCJleHAiOjE3MDE5MTAzMTcsImlhdCI6MTcwMTkwNjcxNywianRpIjoiYTI3NGVkNzAtODI4YS00NmE3LTgyMDQtZGFiZjIzNTBlMTZhIiwiZW1haWwiOiJzdGVwaGVuX3doZWVsZXJAeWFob28uY29tIn0.d3hr7gfvl8i0LBCCV5-Il9xNwXTtbkhaNpUjKPJX4s9DQqDN-egBj8N1lKjKcR9xgl8uQGVowWs3iEEzYfp5XfFpuYQa-lUyYoA1CKdB227dyfvzhsmDxOnx8INf4uaaCrMGrOdEGkccduHIK2lb8wkkHOJWNc_A_SZAf8wIPYVdHi_b4qYkijxVYuAjnpoxsh7YJBrEVX6j-SYDH8s8dCQGjgd6fV5sOzO_t3AyRUR8N4UPh2-rtshFS1FHND0LvLA5L8vznqEdWt6dWmLU2Q3AG7W5WlQ31eG-tSfKjepgm0Pl7GOgYsLgMFC7X0vBrdLMBSZ4p-UGK7-pMbHhBg';

// Invalid payload - look for 'steve'
const access_token_invalid='eyJraWQiOiJWaW9GSjQ3SzVpZEg4dXF3cVFIMVhTZWNvVmluZDNEZzZCVGlUeWY0RWpBPSIsImFsZyI6IlJTMjU2In0.eysteveiOiJkNDU4MzQxOC0zMGIxLTcwNGItMjMzOC00NmJmMjg4ZDk3NzIiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV9UWTdIczRxUGUiLCJ2ZXJzaW9uIjoyLCJjbGllbnRfaWQiOiIyZG9yZHU4amdtODc0NTBpNG9ybnVrNHFoMyIsImV2ZW50X2lkIjoiMDE1NGMxMTctMTI0OS00ZmUyLWFhZGUtYTkyMTllYTk1YWViIiwidG9rZW5fdXNlIjoiYWNjZXNzIiwic2NvcGUiOiJwaG9uZSBvcGVuaWQgZW1haWwiLCJhdXRoX3RpbWUiOjE3MDE5MDY3MTcsImV4cCI6MTcwMTkxMDMxNywiaWF0IjoxNzAxOTA2NzE3LCJqdGkiOiIzNzkwNGExMy02NTc2LTQyYTAtODNkNS03YmM5OWU1NjM4ODQiLCJ1c2VybmFtZSI6ImQ0NTgzNDE4LTMwYjEtNzA0Yi0yMzM4LTQ2YmYyODhkOTc3MiJ9.H7btwN5wHG1n-dbKuraeghnEmSAa-vXIaL6zlwsdLIFq18SFbeFE-TG2ciXv_lxDsDEddWBo4wgVKCO3KbTJTQYX6PVgDhTgrp4rPLfhaWc6HJX8IgwndpFhvjz2R6C6ImU6HpmwCIE93qQXJo3vLfQikypop8PBef2y8PMx8RGivXanGK_FEsAMHL1hkGy5S0aLfuFm37YZ7bY1QKvoGv3c9zcivyoN8xGCOTI4n8q3QjCQSq6uaOEkdqIEyzuxU5Vw6AtM939x807N7pAhupZmgqj0HKTjwkezw-qgqGMfhI8ZsxubOuscqDsyojkNFnmXnr167AgiekCUuiW1cQ';

describe("Test Access tokens", () => {
    
    it("checks jwt decode works for valid token", () => {
      let result = isAccessCookieValid(access_token_expired);
      expect(result).toBe(false);
    });

    it("checks jwt decode works for invalid token", () => {
      let result = isAccessCookieValid(access_token_invalid);
      expect(result).toBe(false);
    });

    it("checks isAccessCookieValid WORKS for invalid signature - TODO - FIX THIS", () => {
      // We are not doing signature validation yet.
      let result = isAccessCookieValid(id_token_invalid);
      expect(result).toBe(false);
    });

});